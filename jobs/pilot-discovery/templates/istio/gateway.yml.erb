<%=
servers = []
p("router.listeners").each do |k,v|
  servers << {
    "port" => {
      "number" => k,
      "protocol" => v["protocol"],
    },
    "hosts" => v["hosts"],
  }
end

gateway = {
  "apiVersion" => "config.istio.io/v1alpha2",
  "kind" => "Gateway",
  "metadata" => {
    "name" => p("router.name"),
  },
  "spec" => {
    "servers" => servers,
  },
}
gateway.to_yaml()

%>

